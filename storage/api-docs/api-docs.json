{
    "openapi": "3.0.0",
    "info": {
        "title": "OMPAY API",
        "description": "API pour les op√©rations OMPay - FinTech S√©n√©galaise",
        "version": "1.0.0"
    },
    "servers": [
        {
            "url": "http://localhost:8000/api",
            "description": "Serveur de d√©veloppement"
        }
    ],
    "paths": {
        "/auth/register": {
            "post": {
                "tags": [
                    "üîê Auth"
                ],
                "summary": "Inscription d'un nouvel utilisateur",
                "description": "Cr√©e un utilisateur avec compte en attente de v√©rification. Un OTP d'activation sera envoy√© automatiquement.",
                "operationId": "4183f54dfc8f828f20af14b2d41571c3",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "nom": {
                                        "type": "string",
                                        "example": "Diop"
                                    },
                                    "prenom": {
                                        "type": "string",
                                        "example": "Amadou"
                                    },
                                    "telephone": {
                                        "type": "string",
                                        "example": "771234567"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "password123"
                                    },
                                    "password_confirmation": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "password123"
                                    },
                                    "cni": {
                                        "type": "string",
                                        "example": "AB123456789"
                                    },
                                    "sexe": {
                                        "type": "string",
                                        "enum": [
                                            "Homme",
                                            "Femme"
                                        ],
                                        "example": "Homme"
                                    },
                                    "date_naissance": {
                                        "type": "string",
                                        "format": "date",
                                        "example": "1990-01-01"
                                    },
                                    "type_compte": {
                                        "type": "string",
                                        "enum": [
                                            "cheque",
                                            "epargne"
                                        ],
                                        "example": "cheque"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Utilisateur cr√©√© avec succ√®s",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Utilisateur cr√©√© ‚Äì demande de v√©rification OTP"
                                        },
                                        "data": {
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Erreur de validation"
                    }
                }
            }
        },
        "/auth/request-otp": {
            "post": {
                "tags": [
                    "üîê Auth"
                ],
                "summary": "Demander un OTP",
                "description": "Envoie un OTP par SMS. Si compte en attente ‚Üí OTP d'activation. Si compte actif ‚Üí OTP de connexion.",
                "operationId": "8c3f66c4616d0ddcbdc0579de98ef469",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "telephone": {
                                        "type": "string",
                                        "example": "771234567"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "OTP envoy√©",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Code OTP envoy√© par SMS"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Utilisateur non trouv√© ou rate limit d√©pass√©"
                    },
                    "429": {
                        "description": "Trop de tentatives"
                    }
                }
            }
        },
        "/auth/verify-otp": {
            "post": {
                "tags": [
                    "üîê Auth"
                ],
                "summary": "V√©rifier un OTP",
                "description": "V√©rifie l'OTP et active le compte si n√©cessaire, puis retourne les tokens d'acc√®s.",
                "operationId": "6fe84e8705332a974ea42dc3318dcf97",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "telephone": {
                                        "type": "string",
                                        "example": "771234567"
                                    },
                                    "otp": {
                                        "type": "string",
                                        "example": "123456"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Connexion r√©ussie",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Connexion r√©ussie"
                                        },
                                        "data": {
                                            "properties": {
                                                "user": {
                                                    "$ref": "#/components/schemas/User"
                                                },
                                                "tokens": {
                                                    "$ref": "#/components/schemas/AuthTokens"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "OTP invalide ou expir√©"
                    }
                }
            }
        },
        "/auth/refresh": {
            "post": {
                "tags": [
                    "üîê Auth"
                ],
                "summary": "Rafra√Æchir le token d'acc√®s",
                "description": "G√©n√®re un nouveau token d'acc√®s en utilisant le refresh token avec rotation.",
                "operationId": "6109e37da84dd20520267814deda4b98",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "refresh_token": {
                                        "type": "string",
                                        "example": "refresh_token_here"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Token rafra√Æchi",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Token rafra√Æchi"
                                        },
                                        "data": {
                                            "$ref": "#/components/schemas/AuthTokens"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Refresh token invalide"
                    }
                }
            }
        },
        "/auth/login": {
            "post": {
                "tags": [
                    "üîê Auth"
                ],
                "summary": "Connexion avec mot de passe",
                "description": "Authentification classique avec t√©l√©phone et mot de passe pour les comptes d√©j√† activ√©s.",
                "operationId": "1a150bca0394a6265673e30ffafef8b2",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "telephone": {
                                        "type": "string",
                                        "example": "771234567"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "password123"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Connexion r√©ussie",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Connexion r√©ussie"
                                        },
                                        "data": {
                                            "$ref": "#/components/schemas/AuthTokens"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Identifiants invalides"
                    }
                }
            }
        },
        "/ompay/balance": {
            "get": {
                "tags": [
                    "üìä OMPAY Consultation"
                ],
                "summary": "Consulter le solde du compte",
                "description": "R√©cup√®re le solde actuel du compte principal de l'utilisateur",
                "operationId": "5b4a37191e32018a34af323bdd4d177c",
                "parameters": [
                    {
                        "name": "compteId",
                        "in": "query",
                        "description": "ID du compte (optionnel, utilise le compte principal par d√©faut)",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "format": "uuid"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Solde r√©cup√©r√© avec succ√®s",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Solde r√©cup√©r√© avec succ√®s"
                                        },
                                        "data": {
                                            "properties": {
                                                "compte_id": {
                                                    "type": "string",
                                                    "format": "uuid"
                                                },
                                                "numero_compte": {
                                                    "type": "string",
                                                    "example": "OM12345678"
                                                },
                                                "solde": {
                                                    "type": "number",
                                                    "format": "float",
                                                    "example": 1500.5
                                                },
                                                "devise": {
                                                    "type": "string",
                                                    "example": "FCFA"
                                                },
                                                "date_consultation": {
                                                    "type": "string",
                                                    "format": "date-time"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Token d'authentification manquant ou invalide",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Unauthenticated."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Compte non trouv√©",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Aucun compte trouv√©"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/ompay/transfer": {
            "post": {
                "tags": [
                    "üí∏ OMPAY Transactions"
                ],
                "summary": "Effectuer un transfert d'argent",
                "description": "Transf√®re de l'argent vers un autre compte OMPAY",
                "operationId": "e31bce4cdce754a4535593c5bdf1b3cf",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "recipient_telephone": {
                                        "description": "Num√©ro de t√©l√©phone du destinataire",
                                        "type": "string",
                                        "example": "772345678"
                                    },
                                    "amount": {
                                        "description": "Montant √† transf√©rer (FCFA)",
                                        "type": "number",
                                        "format": "float",
                                        "maximum": 1000000,
                                        "minimum": 100,
                                        "example": 500
                                    },
                                    "description": {
                                        "description": "Description optionnelle",
                                        "type": "string",
                                        "maxLength": 255,
                                        "example": "Paiement facture"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Transfert effectu√© avec succ√®s",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Transfert effectu√© avec succ√®s"
                                        },
                                        "data": {
                                            "properties": {
                                                "debit_transaction": {
                                                    "$ref": "#/components/schemas/Transaction"
                                                },
                                                "credit_transaction": {
                                                    "$ref": "#/components/schemas/Transaction"
                                                },
                                                "reference": {
                                                    "type": "string",
                                                    "example": "TXN202511152302356175"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Erreur de validation ou fonds insuffisants",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Solde insuffisant"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Destinataire non trouv√©",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Utilisateur destinataire introuvable"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/ompay/history": {
            "get": {
                "tags": [
                    "üìä OMPAY Consultation"
                ],
                "summary": "Obtenir l'historique des transactions",
                "description": "R√©cup√®re l'historique pagin√© des transactions de l'utilisateur",
                "operationId": "7f159acd4d66cccf7723d44fe0e637af",
                "parameters": [
                    {
                        "name": "page",
                        "in": "query",
                        "description": "Num√©ro de page",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "default": 1,
                            "minimum": 1
                        }
                    },
                    {
                        "name": "per_page",
                        "in": "query",
                        "description": "Nombre d'√©l√©ments par page",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "default": 20,
                            "maximum": 100,
                            "minimum": 1
                        }
                    },
                    {
                        "name": "type",
                        "in": "query",
                        "description": "Filtrer par type de transaction",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "depot",
                                "retrait",
                                "transfert"
                            ]
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Historique r√©cup√©r√© avec succ√®s",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Historique r√©cup√©r√© avec succ√®s"
                                        },
                                        "data": {
                                            "properties": {
                                                "transactions": {
                                                    "type": "array",
                                                    "items": {
                                                        "$ref": "#/components/schemas/Transaction"
                                                    }
                                                },
                                                "pagination": {
                                                    "properties": {
                                                        "current_page": {
                                                            "type": "integer",
                                                            "example": 1
                                                        },
                                                        "per_page": {
                                                            "type": "integer",
                                                            "example": 20
                                                        },
                                                        "total": {
                                                            "type": "integer",
                                                            "example": 150
                                                        },
                                                        "last_page": {
                                                            "type": "integer",
                                                            "example": 8
                                                        }
                                                    },
                                                    "type": "object"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Non authentifi√©",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Unauthenticated."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/ompay/logout": {
            "post": {
                "tags": [
                    "üîê Auth"
                ],
                "summary": "D√©connexion utilisateur",
                "description": "Invalide tous les tokens d'acc√®s et de rafra√Æchissement",
                "operationId": "b7c46636fca654a4b5627ce9918f7d4f",
                "responses": {
                    "200": {
                        "description": "D√©connexion r√©ussie",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "D√©connexion r√©ussie"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Non authentifi√©",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Unauthenticated."
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/ompay/deposit": {
            "post": {
                "tags": [
                    "üí∏ OMPAY Transactions"
                ],
                "summary": "Effectuer un d√©p√¥t d'argent",
                "description": "Ajoute des fonds sur le compte de l'utilisateur",
                "operationId": "117061371c3cc7479a0514fb9ad48032",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "amount": {
                                        "description": "Montant √† d√©poser (FCFA)",
                                        "type": "number",
                                        "format": "float",
                                        "maximum": 5000000,
                                        "minimum": 100,
                                        "example": 1000
                                    },
                                    "description": {
                                        "description": "Description optionnelle",
                                        "type": "string",
                                        "maxLength": 255,
                                        "example": "D√©p√¥t esp√®ces"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "D√©p√¥t effectu√© avec succ√®s",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "D√©p√¥t effectu√© avec succ√®s"
                                        },
                                        "data": {
                                            "properties": {
                                                "transaction": {
                                                    "$ref": "#/components/schemas/Transaction"
                                                },
                                                "reference": {
                                                    "type": "string",
                                                    "example": "TXN202511152258103440"
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Erreur de validation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": false
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Le montant doit √™tre sup√©rieur √† 100 FCFA"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/ompay/withdraw": {
            "post": {
                "tags": [
                    "OMPay"
                ],
                "summary": "Effectuer un retrait",
                "operationId": "794b5222b66de59308ba01ac2288067d",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "amount": {
                                        "type": "number"
                                    },
                                    "description": {
                                        "type": "string"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Retrait effectu√©"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        }
    },
    "components": {
        "schemas": {
            "User": {
                "properties": {
                    "id": {
                        "type": "string",
                        "format": "uuid",
                        "example": "550e8400-e29b-41d4-a716-446655440000"
                    },
                    "nom": {
                        "type": "string",
                        "example": "Diop"
                    },
                    "prenom": {
                        "type": "string",
                        "example": "Amadou"
                    },
                    "telephone": {
                        "type": "string",
                        "example": "771234567"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "Actif",
                            "Inactif",
                            "pending_verification"
                        ]
                    },
                    "cni": {
                        "type": "string",
                        "example": "AB123456789"
                    },
                    "sexe": {
                        "type": "string",
                        "enum": [
                            "Homme",
                            "Femme"
                        ]
                    },
                    "role": {
                        "type": "string",
                        "enum": [
                            "client",
                            "admin"
                        ]
                    }
                },
                "type": "object"
            },
            "Compte": {
                "properties": {
                    "id": {
                        "type": "string",
                        "format": "uuid"
                    },
                    "numero_compte": {
                        "type": "string",
                        "example": "OM12345678"
                    },
                    "type": {
                        "type": "string",
                        "enum": [
                            "cheque",
                            "epargne"
                        ]
                    },
                    "statut": {
                        "type": "string",
                        "enum": [
                            "actif",
                            "inactif",
                            "bloqu√©",
                            "ferm√©"
                        ]
                    },
                    "solde": {
                        "type": "number",
                        "format": "float",
                        "example": 1500.5
                    },
                    "created_at": {
                        "type": "string",
                        "format": "date-time"
                    }
                },
                "type": "object"
            },
            "Transaction": {
                "properties": {
                    "id": {
                        "type": "integer"
                    },
                    "type": {
                        "type": "string",
                        "enum": [
                            "depot",
                            "retrait",
                            "transfert"
                        ]
                    },
                    "montant": {
                        "type": "number",
                        "format": "float",
                        "example": 1000
                    },
                    "statut": {
                        "type": "string",
                        "enum": [
                            "reussi",
                            "echec",
                            "en_cours"
                        ]
                    },
                    "description": {
                        "type": "string",
                        "nullable": true
                    },
                    "reference": {
                        "type": "string",
                        "example": "TXN202511152300034086"
                    },
                    "date_operation": {
                        "type": "string",
                        "format": "date-time"
                    }
                },
                "type": "object"
            },
            "ApiResponse": {
                "properties": {
                    "success": {
                        "type": "boolean",
                        "example": true
                    },
                    "message": {
                        "type": "string",
                        "example": "Op√©ration r√©ussie"
                    },
                    "data": {
                        "type": "object",
                        "nullable": true
                    }
                },
                "type": "object"
            },
            "AuthTokens": {
                "properties": {
                    "access_token": {
                        "type": "string",
                        "example": "1|hCrUqzgS8DhPIk3CLIaV1gsvtEmGrKn9IWxsoxkD04360b9a"
                    },
                    "refresh_token": {
                        "type": "string",
                        "example": "tXV9BauXVgz7NElE7bF4NcM2hqSdFCKDn8kV11oaUn4czTroQSnQUoPGkPWMgN8a"
                    },
                    "token_type": {
                        "type": "string",
                        "example": "Bearer"
                    },
                    "expires_in": {
                        "type": "integer",
                        "example": 900
                    }
                },
                "type": "object"
            }
        },
        "securitySchemes": {
            "bearerAuth": {
                "type": "http",
                "scheme": "bearer",
                "bearerFormat": "JWT",
                "description": "Enter JWT token in format (Bearer <token>)"
            }
        }
    },
    "tags": [
        {
            "name": "üîê Auth",
            "description": "Authentification et gestion des utilisateurs"
        },
        {
            "name": "üí∏ OMPAY Transactions",
            "description": "Op√©rations financi√®res (d√©p√¥t, retrait, transfert)"
        },
        {
            "name": "üìä OMPAY Consultation",
            "description": "Consultation soldes et historiques"
        },
        {
            "name": "OMPay",
            "description": "OMPay"
        }
    ]
}